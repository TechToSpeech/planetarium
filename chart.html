<html>

<head>
  <script src="jquery.csv.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">

    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var queryOptions = {
        csvColumns: ['date', 'number'],
        csvHasHeader: false
      }
      var csvUrl = 'data.csv'
      var query = new google.visualization.Query(csvUrl, queryOptions);
      query.send(handleQueryResponse);
      function handleQueryResponse(response) {

        if (response.isError()) {
          alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
          return;
        }

        var options = {
          title: 'Stargazers Over Time',
          curveType: 'function',
          legend: { position: 'none' },
          width: 800
        };
        var data = response.getDataTable();
        var getKeys = function (data) {
          var keys = [];
          for (var key in data) {
            keys.push(key);
          }
          return keys;
          alert(keys);
        }
        //alert(data.getColumnLabel(0));
        var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
        google.visualization.events.addListener(chart, 'ready', function () {
          curve_chart.innerHTML = '<img id="chart" src="' + chart.getImageURI() + '">';
          document.getElementById("download_link").setAttribute("href", chart.getImageURI())
          document.getElementById("download_link").click();
        });
        chart.draw(data, options);
      }
    }
  </script>
</head>

<body>
  <div id="curve_chart" style="width: 900px; height: 500px"></div>
  <a style="display:none" id="download_link" href="/" download>download</a>
</body>

</html>